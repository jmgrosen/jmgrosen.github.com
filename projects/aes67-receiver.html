<!DOCTYPE html>
<html lang="en"><head><title>aes67 receiver</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="aes67 receiver"/><meta property="og:description" content="RasPi-based prototype Hardware Raspberry Pi Compute Module 4, which has an Ethernet MAC that supports the necessary timestamping for IEEE 1588 the 1GB RAM, 8GB eMMC, no wifi variant ..."/><meta property="og:image" content="https://jessie.grosen.systems/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="RasPi-based prototype Hardware Raspberry Pi Compute Module 4, which has an Ethernet MAC that supports the necessary timestamping for IEEE 1588 the 1GB RAM, 8GB eMMC, no wifi variant ..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="projects/aes67-receiver"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="..">it's jessie</a></h2><div class="spacer mobile-only"></div><div class="explorer desktop-only"><span id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="false" data-tree="[{&quot;path&quot;:&quot;interests&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;interests/transit&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;interests/transit/nyc&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;posts&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;projects&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;projects/miscellanea&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;talks&quot;,&quot;collapsed&quot;:true}]"></span><div id="explorer-content"><ul class id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="interests"><button class="folder-button"><span class="folder-title">interests</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="interests"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="interests/transit"><button class="folder-button"><span class="folder-title">transit</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="interests/transit"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="interests/transit/nyc"><button class="folder-button"><span class="folder-title">nyc</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="interests/transit/nyc"><li><a href="../interests/transit/nyc/R211T" data-for="interests/transit/nyc/R211T">R211T</a></li></ul></div></li></ul></div></li></ul></div></li><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="posts"><button class="folder-button"><span class="folder-title">posts</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="posts"><li><a href="../posts/distance-audio-modulator" data-for="posts/distance-audio-modulator">distance audio modulator</a></li><li><a href="../posts/i-think-i'm-beginning-to-recover" data-for="posts/i-think-i'm-beginning-to-recover">i think i'm beginning to recover</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="projects"><button class="folder-button"><span class="folder-title">projects</span></button></div></div><div class="folder-outer open"><ul style="padding-left:1.4rem;" class="content" data-folderul="projects"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="projects/miscellanea"><button class="folder-button"><span class="folder-title">miscellanea</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="projects/miscellanea"><li><a href="../projects/miscellanea/crashing-waves" data-for="projects/miscellanea/crashing-waves">crashing waves</a></li><li><a href="../projects/miscellanea/Zoom-G1Xon-control" data-for="projects/miscellanea/Zoom-G1Xon-control">Zoom G1Xon control</a></li></ul></div></li><li><a href="../projects/aes67-receiver" data-for="projects/aes67-receiver">aes67 receiver</a></li><li><a href="../projects/mta-projection" data-for="projects/mta-projection">mta projection</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="talks"><button class="folder-button"><span class="folder-title">talks</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="talks"><li><a href="../talks/mustard-watches" data-for="talks/mustard-watches">mustard watches</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../projects/">projects</a></div></nav><h1 class="article-title">aes67 receiver</h1><p show-comma="true" class="content-meta"><span>Sep 07, 2024</span></p></div></div><article class="popover-hint"><h1 id="raspi-based-prototype">RasPi-based prototype<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#raspi-based-prototype" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<h2 id="hardware">Hardware<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hardware" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ul>
<li>Raspberry Pi Compute Module 4, which has an Ethernet MAC that supports the necessary timestamping for IEEE 1588
<ul>
<li>the 1GB RAM, 8GB eMMC, no wifi variant.</li>
</ul>
</li>
<li><a href="https://www.waveshare.com/wiki/CM4-NANO-B" class="external">Waveshare CM4-NANO-B<svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> carrier board, which has both an Ethernet port and an audio jack (just driven off of the Pi’s PWM, so surely shitty audio, but good enough for testing).</li>
</ul>
<h2 id="software">Software<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#software" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Using <a href="https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/AES67" class="external">Pipewire’s preliminary AES67 support<svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>.</p>
<h3 id="setting-up-the-pi">Setting up the Pi<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#setting-up-the-pi" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>Use the Raspberry Pi OS Lite image; I used specifically <a href="https://downloads.raspberrypi.com/raspios_lite_armhf/images/raspios_lite_armhf-2024-07-04/2024-07-04-raspios-bookworm-armhf-lite.img.xz" class="external">the 32-bit July 4th 2024 build<svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> (should I have used a 64-bit build?). If the Pi eMMC is empty (as it is the first time you connect it), it will show up as a USB mass storage device immediately. However, once you flash something, you need to use the <a href="https://github.com/raspberrypi/usbboot" class="external">rpiboot utility from the raspi usbboot repo<svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> in order to get it to show up as a mass storage device, even once you switch the CM4-NANO-B into boot mode. <a href="https://www.raspberrypi.com/documentation/computers/configuration.html#remote-access" class="external">Add an empty “ssh” file and a “userconf” file with contents <code>user:$(echo pass | openssl passwd -6 -stdin)</code><svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> to the boot volume (if you do this before ever booting you won’t need to use the rpiboot utility). mDNS is enabled for hostname <code>raspberrypi</code> by default.</p>
<p>To enable the shitty PWM-based audio, adapting from <a href="https://www.waveshare.com/wiki/CM4-NANO-B#Audio_Jack" class="external">the wiki page for the carrier board<svg aria-hidden="true" class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>, add <code>dtoverlay=audremap,pins_18_19</code> to the bottom of <code>/boot/firmware/config.txt</code> (ensure that <code>dtparam=audio=on</code> is already there; if not, add it). Reboot. Test it with <code>aplay -L</code> to confirm “bcm2835 headphones” is listed as a card, then plug in some headphones and play a wav with <code>aplay foo.wav</code>.</p>
<h3 id="setting-up-pipewire">Setting up Pipewire<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#setting-up-pipewire" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>We need a fairly recent Pipewire (at least, say, 1.2), beyond that which is available in Bookworm, the version of Debian that the Raspberry Pi OS I’m using is based on. So we need to use the version from bookworm-backports, first adding the Debian signing key since it’s different from Raspbian’s:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="sh" data-theme="github-light github-dark"><code data-language="sh" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://ftp-master.debian.org/keys/archive-key-12.asc</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> archive-key-12.asc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/trusted.gpg.d/debian-bookworm-archive.asc</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://deb.debian.org/debian</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bookworm-backports</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/sources.list.d/backports.list</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bookworm-backports</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pipewire</span></span></code></pre></figure></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="toc desktop-only"><button type="button" id="toc" class aria-controls="toc-content" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#raspi-based-prototype" data-for="raspi-based-prototype">RasPi-based prototype</a></li><li class="depth-1"><a href="#hardware" data-for="hardware">Hardware</a></li><li class="depth-1"><a href="#software" data-for="software">Software</a></li><li class="depth-2"><a href="#setting-up-the-pi" data-for="setting-up-the-pi">Setting up the Pi</a></li><li class="depth-2"><a href="#setting-up-pipewire" data-for="setting-up-pipewire">Setting up Pipewire</a></li></ul></div></div> </div></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">
        const socket = new WebSocket('ws://localhost:3001')
        // reload(true) ensures resources like images and scripts are fetched again in firefox
        socket.addEventListener('message', () => document.location.reload(true))
      </script><script src="../postscript.js" type="module"></script></html>