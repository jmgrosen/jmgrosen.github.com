{"index":{"title":"it's me","links":[],"tags":[],"content":"hey there!\n","richContent":"&lt;p&gt;hey there!&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;./public-media/me.webp&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;"},"interests/transit/nyc/R211T":{"title":"R211T","links":[],"tags":[],"content":"i managed to catch a ride on one of the MTA’s fancy new trains with open gangways!\n\n\nthey were quite snazzy and functional—i saw many people standing in the gangway while it was more crowded and rode just fine in it myself.\nbesides the open gangways, the most useful improvement i saw was the intricate wayfinding information displayed at each stop: where to find which staircases/elevators relative to one’s position. this convinced me that replacing the LED textual stop information with general purpose screens really is worth it.\n\ni saw these odd devices next to two of the doors (one on each side) on each car:\n\ni really could not figure out what their purpose is, even after searching online. if you have any idea, please let me know!\nhopefully they figure out a way to inspect between the cars so that it can run on the A as well.","richContent":"&lt;p&gt;i managed to catch a ride on one of the MTA’s fancy new trains with open gangways!\n&lt;img src=&quot;../../../public-media/trains/18A690FC-BF82-4D98-BD80-02BA5E0EFD55_1_105_c.jpeg&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;\n&lt;img src=&quot;../../../public-media/trains/B92193B0-62FB-4974-BF28-BE17412ACA32_1_105_c.jpeg&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;p&gt;they were quite snazzy and functional—i saw many people standing in the gangway while it was more crowded and rode just fine in it myself.&lt;/p&gt;\n&lt;p&gt;besides the open gangways, the most useful improvement i saw was the intricate wayfinding information displayed at each stop: where to find which staircases/elevators relative to one’s position. this convinced me that replacing the LED textual stop information with general purpose screens really is worth it.\n&lt;img src=&quot;../../../public-media/trains/11C79703-E128-4B9F-8EFE-571294A4C30F_1_105_c.jpeg&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;p&gt;i saw these odd devices next to two of the doors (one on each side) on each car:\n&lt;img src=&quot;../../../public-media/trains/73E74488-A893-40CC-BDC3-2028C2A8E544_1_105_c.jpeg&quot; width=&quot;300&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;p&gt;i really could not figure out what their purpose is, even after searching online. if you have any idea, please let me know!&lt;/p&gt;\n&lt;p&gt;hopefully they figure out a way to inspect between the cars &lt;a href=&quot;https://gothamist.com/news/mtas-fancy-new-open-gangway-subway-trains-cant-run-on-express-tracks-per-memo&quot; class=&quot;external&quot;&gt;so that it can run on the A as well&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;.&lt;/p&gt;"},"posts/distance-audio-modulator":{"title":"distance audio modulator","links":[],"tags":[],"content":"recently, my friend zero told me an idea it had to add some crowd-mediated interactivity to a live show: measure how close together a particular few people are by looking at bluetooth signal strengths, then report that back to the synth to modulate some parameters.\nwe whittled that down to a simpler starting place: estimate distances to a few devices directly from the central laptop, then emit some midi CC values based on that. with some trial and error, we got that to work! here’s a little demo video:\n\nit’s pretty inconsistent and high latency, as you can tell. i bet if we wrote a little app that sent out bluetooth pings every 25ms we could probably address those, though of course with some tradeoff between the two.\nhere’s the python script we wrote:\nimport asyncio\nimport hashlib\n \nimport ipdb\nfrom bleak import BleakScanner\nimport mido\n \n \nNUM_CCS = 8\nBASE_CC = 70\n \nMIN_RSSI = 0x30\nMAX_RSSI = 0x60\n \ndef clamp(lo, hi, x):\n    if x &lt; lo:\n        return lo\n    elif x &gt; hi:\n        return hi\n    else:\n        return x\n \ndef scale(from_lo, from_hi, to_lo, to_hi, x):\n    return (clamp(from_lo, from_hi, x) - from_lo) / (from_hi - from_lo) * (to_hi - to_lo) + to_lo\n \ndef rssi_to_midi(rssi):\n    return round(scale(MIN_RSSI, MAX_RSSI, 0, 127, abs(rssi)))\n \ndef valid_ad(dev, ad):\n    return dev.name is not None and \\\n           dev.name.startswith(&#039;Jessie&#039;) and \\\n           ad.rssi is not None and \\\n           (ad.tx_power is None or ad.tx_power &lt; 50)\n \ndef update_cc(port, cc, val):\n    port.send(mido.Message(&#039;control_change&#039;, control=cc, value=val))\n \nasync def main():\n    port = mido.open_output()\n    cc_nums = {}\n    async with BleakScanner() as scanner:\n        async for bd, ad in scanner.advertisement_data():\n            if not valid_ad(bd, ad):\n                continue\n            if bd.address not in cc_nums:\n                if len(cc_nums) &lt; NUM_CCS:\n                    cc_nums[bd.address] = BASE_CC + len(cc_nums)\n                else:\n                    continue\n \n            val = rssi_to_midi(ad.rssi - (ad.tx_power or 8))\n            print(f&quot;{bd.name} -&gt; {val}&quot;)\n            update_cc(port, cc_nums[bd.address], val)\n \n \nif __name__ == &#039;__main__&#039;:\n    asyncio.run(main())\nif i/we work on it any more, i’ll put it in a repo somewhere","richContent":"&lt;p&gt;recently, my friend zero told me an idea it had to add some crowd-mediated interactivity to a live show: measure how close together a particular few people are by looking at bluetooth signal strengths, then report that back to the synth to modulate some parameters.&lt;/p&gt;\n&lt;p&gt;we whittled that down to a simpler starting place: estimate distances to a few devices directly from the central laptop, then emit some midi CC values based on that. with some trial and error, we got that to work! here’s a little demo video:\n&lt;video src=&quot;../public-media/midi_rssi_example.mov&quot; controls&gt;&lt;/video&gt;\nit’s pretty inconsistent and high latency, as you can tell. i bet if we wrote a little app that sent out bluetooth pings every 25ms we could probably address those, though of course with some tradeoff between the two.&lt;/p&gt;\n&lt;p&gt;here’s the python script we wrote:&lt;/p&gt;\n&lt;figure data-rehype-pretty-code-figure=&quot;&quot;&gt;&lt;pre tabindex=&quot;0&quot; data-language=&quot;python&quot; data-theme=&quot;github-light github-dark&quot;&gt;&lt;code data-language=&quot;python&quot; data-theme=&quot;github-light github-dark&quot; style=&quot;display: grid;&quot;&gt;&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; asyncio&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; hashlib&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; ipdb&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;from&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; bleak &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; BleakScanner&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; mido&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;NUM_CCS&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; =&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; 8&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;BASE_CC&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; =&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; 70&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;MIN_RSSI&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; =&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; 0x&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;30&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;MAX_RSSI&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; =&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; 0x&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;60&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; clamp&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(lo, hi, x):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    if&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; x &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;&amp;#x3C;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; lo:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;        return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; lo&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    elif&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; x &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;&gt;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; hi:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;        return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; hi&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    else&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;        return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; x&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; scale&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(from_lo, from_hi, to_lo, to_hi, x):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; (clamp(from_lo, from_hi, x) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; from_lo) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; (from_hi &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; from_lo) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; (to_hi &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; to_lo) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; to_lo&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; rssi_to_midi&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(rssi):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; round&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(scale(&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;MIN_RSSI&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;MAX_RSSI&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;127&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;abs&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(rssi)))&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; valid_ad&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(dev, ad):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    return&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; dev.name &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;is&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; not&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; None&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; and&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; \\&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;           dev.name.startswith(&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt;&#039;Jessie&#039;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;and&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; \\&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;           ad.rssi &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;is&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; not&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; None&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; and&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; \\&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;           (ad.tx_power &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;is&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; None&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; or&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; ad.tx_power &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;&amp;#x3C;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; 50&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;)&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; update_cc&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(port, cc, val):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;    port.send(mido.Message(&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt;&#039;control_change&#039;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#E36209;--shiki-dark:#FFAB70&quot;&gt;control&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;cc, &lt;/span&gt;&lt;span style=&quot;--shiki-light:#E36209;--shiki-dark:#FFAB70&quot;&gt;value&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;val))&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;async&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; def&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; main&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;():&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;    port &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; mido.open_output()&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;    cc_nums &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; {}&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;    async&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; with&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; BleakScanner() &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;as&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; scanner:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;        async&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; for&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; bd, ad &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;in&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; scanner.advertisement_data():&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;            if&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; not&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; valid_ad(bd, ad):&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;                continue&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;            if&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; bd.address &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;not&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; in&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; cc_nums:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;                if&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; len&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(cc_nums) &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;&amp;#x3C;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; NUM_CCS&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;                    cc_nums[bd.address] &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; BASE_CC&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; +&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; len&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(cc_nums)&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;                else&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;                    continue&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;            val &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; rssi_to_midi(ad.rssi &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt; (ad.tx_power &lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;or&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; 8&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;))&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;            print&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;f&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;bd.name&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; -&gt; &lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;{&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;val&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;)&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;            update_cc(port, cc_nums[bd.address], val)&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt; &lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; __name__&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; ==&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; &#039;__main__&#039;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;:&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#24292E;--shiki-dark:#E1E4E8&quot;&gt;    asyncio.run(main())&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;\n&lt;p&gt;if i/we work on it any more, i’ll put it in a repo somewhere&lt;/p&gt;"},"posts/i-think-i'm-beginning-to-recover":{"title":"i think i'm beginning to recover","links":[],"tags":[],"content":"by the end of the third year of my phd program, i was beginning to show external signs of hitting my stride: nearly finishing my course requirements, having a first-author paper accepted at a major conference, generating my own promising (if meager) research ideas. but internally, i was a trainwreck. i spent most days in the office doing nothing but doomscrolling. the very thought of opening up my in-progress proofs or writing some inference rules on the whiteboard spiked my anxiety to such an extent that the ensuing headache made work all but impossible anyway.\nmaybe it was my grandiose expectations of myself conflicting with my lack of field-redefining work. maybe it was covid’s isolation that prevented me from picking up good grad student habits by osmosis. maybe it was the weight of my increasing disillusion that tech could ever do any good in the world. maybe it was just burnout.\nmy varied attempts to fix the situation while continuing to come to school each day had failed, so i knew i needed something else. i took leave.\n\nhalf a year later, i’m don’t think i’ve solved anything. but i have begun clawing something back: joy.\ni started my batch at the Recurse Center this week. everyone is excited about what they’re building and learning, and everyone is excited by everyone else. no one interrupts a presentation to ask, “didn’t Robin Milner solve this in the 80s?”\ni’m building things that have been built before. i’m learning things for my sake. i’m believing that tech can be neat. i’m regaining control over my mind.\ni don’t expect RC to be a cure-all. a loving community is a pretty good start, though.","richContent":"&lt;p&gt;by the end of the third year of my phd program, i was beginning to show external signs of hitting my stride: nearly finishing my course requirements, having a first-author paper accepted at a major conference, generating my own promising (if meager) research ideas. but internally, i was a trainwreck. i spent most days in the office doing nothing but doomscrolling. the very thought of opening up my in-progress proofs or writing some inference rules on the whiteboard spiked my anxiety to such an extent that the ensuing headache made work all but impossible anyway.&lt;/p&gt;\n&lt;p&gt;maybe it was my grandiose expectations of myself conflicting with my lack of field-redefining work. maybe it was covid’s isolation that prevented me from picking up good grad student habits by osmosis. maybe it was the weight of my increasing disillusion that tech could ever do any good in the world. maybe it was just burnout.&lt;/p&gt;\n&lt;p&gt;my varied attempts to fix the situation while continuing to come to school each day had failed, so i knew i needed something else. i took leave.&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;half a year later, i’m don’t think i’ve &lt;em&gt;solved&lt;/em&gt; anything. but i have begun clawing something back: joy.&lt;/p&gt;\n&lt;p&gt;i started my batch at the &lt;a href=&quot;https://www.recurse.com&quot; class=&quot;external&quot;&gt;Recurse Center&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; this week. &lt;em&gt;everyone&lt;/em&gt; is excited about what they’re building and learning, and &lt;em&gt;everyone&lt;/em&gt; is excited by everyone else. no one interrupts a presentation to ask, “didn’t Robin Milner solve this in the 80s?”&lt;/p&gt;\n&lt;p&gt;i’m building things that have been built before. i’m learning things for my sake. i’m believing that tech can be neat. i’m regaining control over my mind.&lt;/p&gt;\n&lt;p&gt;i don’t expect RC to be a cure-all. a loving community is a pretty good start, though.&lt;/p&gt;"},"projects/aes67-receiver":{"title":"aes67 receiver","links":[],"tags":[],"content":"these are mostly notes for myself so far, not any sort of writeup that’s supposed to be legible. enjoy if you dare!\nRasPi-based prototype\nHardware\n\nRaspberry Pi Compute Module 4, which has an Ethernet MAC that supports the necessary timestamping for IEEE 1588\n\nthe 1GB RAM, 8GB eMMC, no wifi variant.\n\n\nWaveshare CM4-NANO-B carrier board, which has both an Ethernet port and an audio jack (just driven off of the Pi’s PWM, so surely shitty audio, but good enough for testing).\n\nSoftware\nUsing Pipewire’s preliminary AES67 support.\nSetting up the Pi\nUse the Raspberry Pi OS Lite image; I used specifically the 32-bit July 4th 2024 build (should I have used a 64-bit build?). If the Pi eMMC is empty (as it is the first time you connect it), it will show up as a USB mass storage device immediately. However, once you flash something, you need to use the rpiboot utility from the raspi usbboot repo in order to get it to show up as a mass storage device, even once you switch the CM4-NANO-B into boot mode. Add an empty “ssh” file and a “userconf” file with contents user:$(echo pass | openssl passwd -6 -stdin) to the boot volume (if you do this before ever booting you won’t need to use the rpiboot utility). mDNS is enabled for hostname raspberrypi by default.\nTo enable the shitty PWM-based audio, adapting from the wiki page for the carrier board, add dtoverlay=audremap,pins_18_19 to the bottom of /boot/firmware/config.txt (ensure that dtparam=audio=on is already there; if not, add it). Reboot. Test it with aplay -L to confirm “bcm2835 headphones” is listed as a card, then plug in some headphones and play a wav with aplay foo.wav.\nSetting up Pipewire\nWe need a fairly recent Pipewire (at least, say, 1.2), beyond that which is available in Bookworm, the version of Debian that the Raspberry Pi OS I’m using is based on. So we need to use the version from bookworm-backports, first adding the Debian signing key since it’s different from Raspbian’s:\nwget ftp-master.debian.org/keys/archive-key-12.asc\nsudo mv archive-key-12.asc /etc/apt/trusted.gpg.d/debian-bookworm-archive.asc\necho deb deb.debian.org/debian bookworm-backports main | sudo tee /etc/apt/sources.list.d/backports.list\nsudo apt update\nsudo apt install -t bookworm-backports pipewire\nWe need to set up ptp4l to do timesyncing. For now we don’t have any other possible grandmasters on the network, so we’ll keep the default config that allows the Pi to act as grandmaster.\nsudo apt install linuxptp\necho &#039;KERNEL==&quot;ptp[0-9]*&quot;, MODE=&quot;0644&quot;&#039; | sudo tee /etc/udev/rules.d/90-pipewire-aes67-ptp.rules\nsudo systemctl enable --now ptp4l@eth0.service\nThen set up Pipewire’s actual AES67 support, by putting this configuration in ~/.config/pipewire/pipewire.conf.d/10-aes67.conf\nmkdir -p ~/.config/pipewire/pipewire.conf.d\ncd ~/.config/pipewire/pipewire.conf.d\ncurl gist.githubusercontent.com/jmgrosen/fb214bb9fe36b27a8847b99c6590eb49/raw/7774310bcb8c698beda33b644f22d4e348f34446/10-aes67.conf\nAdd threadirqs to kernel command line /boot/firmware/cmdline.txt.\nUnfortunately the builtin PWM-based audio driver for the Pi requires very large period sizes (1024), so the lowest latency we seem to be able to get is about 46ms (\\approx 2 \\cdot 1024 / 48000). We will in fact need a different DAC to get decent latency.\nHost Audio Drivers\nLinux\nThe Pipewire AES67 support seems to work pretty well. There’s also an ALSA driver that I haven’t tried.\nmacOS\nThe Merging RAVENNA/AES67 Virtual Audio Device seems to be the main driver. It used to be available for free, but now it’s $50. An even bigger issue is that it causes my laptop to kernel panic frequently, making it really a nonstarter for actual use. Might be good enough for testing, though. Follow this guide to configure SAP announcements (in addition to the built-in RAVENNA (mDNS) announcements) that Pipewire can look for.\nso i’m working on my own\n2024-10-12\nworking on the ptp implementation around statime. macos doesn’t seem to have a way to actually use any available hardware timestamping of ethernet interfaces? at least from userspace. it has the normal SO_TIMESTAMP (and mach_absolute_time-based SO_TIMESTAMP_MONOTONIC) for doing software timestamping on receives though. for now for TX timestamps i’ll just timestamp when a packet goes out from my code and eventually change to using the ptpd approach of using the multicast loopback receive to get the TX timestamp a bit closer to the metal.\ndo i have to make a shared-reference version of OverlayClock? probably\ngot frustrated.\nLinks\nto set dscp value correctly in the packets from the driver: gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/src/modules/module-rtp-sink.c\nSTM32-based prototype\ngot a Nucleo-F767ZI. got an STM32F7-based board because that’s what the statime-stm32 example uses.\nalso got a pimoroni pico audio kit because that seemed like the simplest/cheapest i2s dac board that microcenter had with a jack rather than speaker amplifier.\n2024-10-12\nhooked together the Nucleo and pimoroni kit:\n\n\nVSYS ←&gt; 5V\nGND ←&gt; GND\nMUTE ←&gt; CN8_16/D50/PG3\nI2S_DATA ←&gt; CN7_3/D17/I2S_A_SD/PB15\nI2S_BCK ←&gt; CN10_?/D?/?/PB10 (originally CN7_5/D18/I2S_A_CK/PB13 but that conflicts with ethernet pins)\nI2S_LRCK ←&gt; CN7_7/D19/I2S_A_WS/PB12\n\n2024-10-13\ntrying to figure out how to do I2S on the STM32F7 from Rust. it seems like it’s not supported in stm32f7xx-hal, but the I2S peripheral on the stm32f7 is almost identical to that on the stm32f4, so hopefully we can steal some of the code from stm32f4xx-hal.\ni realized the microusb cable i took home from resistor is power-only. rip.\n2024-10-14\nat resistor, equipped with a proper microusb cable, i was able to program the board with statime-stm32 and receive ptp packets! however, i couldn’t get lawo vsc to synchronize with it… i’m not sure whether this is due to some big problem or the ptp profile probably not being set correctly in statime-stm32. the logs for lawo vsc say “cannot use PTP ⇒ T1 value differs too much”.\ni don’t think it’s just the port config. i changed the values to match those from the aes67 spec with no difference observed. i don’t see any ptp packets coming from my laptop, though, which seems very odd? it’s not, like, sending them at a level too low for wireshark to see, is it?\ni guess i’ll switch to getting i2s to work.\noh, it does sync with ptpd on my laptop, though! encouraging!\n2024-10-19\nmaking progress on setting up the i2s in stm32f7xx-hal…\ni was worried that i might not be able to get intra-sample phase sync (though it’s unclear how important that really is anyway…) due to not being able to “nudge” the i2s pll or in general control its phase, but then i realized that we’ll typically run the actual pll a lot faster than the i2s bit clock and so we can set the phase by controlling when exactly we enable the bit clock. that means we should have like 10-100ns accuracy (at the example i2s clk frequency of ~61MHz) assuming we can work out the interrupts nicely.\n… but of course we can’t control the precise frequency of the i2s plls across devices so what good is that. it doesn’t look like there’s an easy way to nudge the pll…\n2024-10-25\nperhaps the stm32h7 has more appropriate PLLs? community.st.com/t5/stm32-mcus-embedded-software/pll-anybody-using-the-internal-plls-as-vco-for-audio/td-p/145437\nor could just use an external vcxo, but that’s another part (but not that expensive of a part—looks like an appropriate one on digikey for $1.67@qty100)\n2024-10-26\ngot i2s working, finally! really hacky driver wrapper at the moment, but it does the job\n2024-10-27\ngonna get dma working for the i2s then introduce rtic\ngodddd stm32f7xx-hal sucks… i don’t think rust is really a great idea on stm32s…","richContent":"&lt;p&gt;these are mostly notes for myself so far, not any sort of writeup that’s supposed to be legible. enjoy if you dare!&lt;/p&gt;\n&lt;h1 id=&quot;raspi-based-prototype&quot;&gt;RasPi-based prototype&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#raspi-based-prototype&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;h2 id=&quot;hardware&quot;&gt;Hardware&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#hardware&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;Raspberry Pi Compute Module 4, which has an Ethernet MAC that supports the necessary timestamping for IEEE 1588\n&lt;ul&gt;\n&lt;li&gt;the 1GB RAM, 8GB eMMC, no wifi variant.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://www.waveshare.com/wiki/CM4-NANO-B&quot; class=&quot;external&quot;&gt;Waveshare CM4-NANO-B&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; carrier board, which has both an Ethernet port and an audio jack (just driven off of the Pi’s PWM, so surely shitty audio, but good enough for testing).&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=&quot;software&quot;&gt;Software&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#software&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;Using &lt;a href=&quot;https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/AES67&quot; class=&quot;external&quot;&gt;Pipewire’s preliminary AES67 support&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;.&lt;/p&gt;\n&lt;h3 id=&quot;setting-up-the-pi&quot;&gt;Setting up the Pi&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#setting-up-the-pi&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h3&gt;\n&lt;p&gt;Use the Raspberry Pi OS Lite image; I used specifically &lt;a href=&quot;https://downloads.raspberrypi.com/raspios_lite_armhf/images/raspios_lite_armhf-2024-07-04/2024-07-04-raspios-bookworm-armhf-lite.img.xz&quot; class=&quot;external&quot;&gt;the 32-bit July 4th 2024 build&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; (should I have used a 64-bit build?). If the Pi eMMC is empty (as it is the first time you connect it), it will show up as a USB mass storage device immediately. However, once you flash something, you need to use the &lt;a href=&quot;https://github.com/raspberrypi/usbboot&quot; class=&quot;external&quot;&gt;rpiboot utility from the raspi usbboot repo&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; in order to get it to show up as a mass storage device, even once you switch the CM4-NANO-B into boot mode. &lt;a href=&quot;https://www.raspberrypi.com/documentation/computers/configuration.html#remote-access&quot; class=&quot;external&quot;&gt;Add an empty “ssh” file and a “userconf” file with contents &lt;code&gt;user:$(echo pass | openssl passwd -6 -stdin)&lt;/code&gt;&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; to the boot volume (if you do this before ever booting you won’t need to use the rpiboot utility). mDNS is enabled for hostname &lt;code&gt;raspberrypi&lt;/code&gt; by default.&lt;/p&gt;\n&lt;p&gt;To enable the shitty PWM-based audio, adapting from &lt;a href=&quot;https://www.waveshare.com/wiki/CM4-NANO-B#Audio_Jack&quot; class=&quot;external&quot;&gt;the wiki page for the carrier board&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;, add &lt;code&gt;dtoverlay=audremap,pins_18_19&lt;/code&gt; to the bottom of &lt;code&gt;/boot/firmware/config.txt&lt;/code&gt; (ensure that &lt;code&gt;dtparam=audio=on&lt;/code&gt; is already there; if not, add it). Reboot. Test it with &lt;code&gt;aplay -L&lt;/code&gt; to confirm “bcm2835 headphones” is listed as a card, then plug in some headphones and play a wav with &lt;code&gt;aplay foo.wav&lt;/code&gt;.&lt;/p&gt;\n&lt;h3 id=&quot;setting-up-pipewire&quot;&gt;Setting up Pipewire&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#setting-up-pipewire&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h3&gt;\n&lt;p&gt;We need a fairly recent Pipewire (at least, say, 1.2), beyond that which is available in Bookworm, the version of Debian that the Raspberry Pi OS I’m using is based on. So we need to use the version from bookworm-backports, first adding the Debian signing key since it’s different from Raspbian’s:&lt;/p&gt;\n&lt;figure data-rehype-pretty-code-figure=&quot;&quot;&gt;&lt;pre tabindex=&quot;0&quot; data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot;&gt;&lt;code data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot; style=&quot;display: grid;&quot;&gt;&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;wget&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; https://ftp-master.debian.org/keys/archive-key-12.asc&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; mv&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; archive-key-12.asc&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; /etc/apt/trusted.gpg.d/debian-bookworm-archive.asc&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;echo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; deb&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; http://deb.debian.org/debian&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; bookworm-backports&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; main&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; |&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; tee&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; /etc/apt/sources.list.d/backports.list&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; apt&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; update&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; apt&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; install&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; -t&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; bookworm-backports&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; pipewire&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;\n&lt;p&gt;We need to set up ptp4l to do timesyncing. For now we don’t have any other possible grandmasters on the network, so we’ll keep the default config that allows the Pi to act as grandmaster.&lt;/p&gt;\n&lt;figure data-rehype-pretty-code-figure=&quot;&quot;&gt;&lt;pre tabindex=&quot;0&quot; data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot;&gt;&lt;code data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot; style=&quot;display: grid;&quot;&gt;&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; apt&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; install&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; linuxptp&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;echo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; &#039;KERNEL==&quot;ptp[0-9]*&quot;, MODE=&quot;0644&quot;&#039;&lt;/span&gt;&lt;span style=&quot;--shiki-light:#D73A49;--shiki-dark:#F97583&quot;&gt; |&lt;/span&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt; sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; tee&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; /etc/udev/rules.d/90-pipewire-aes67-ptp.rules&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;sudo&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; systemctl&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; enable&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; --now&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; ptp4l@eth0.service&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;\n&lt;p&gt;Then set up Pipewire’s actual AES67 support, by putting &lt;a href=&quot;https://gist.github.com/jmgrosen/fb214bb9fe36b27a8847b99c6590eb49&quot; class=&quot;external&quot;&gt;this configuration&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; in &lt;code&gt;~/.config/pipewire/pipewire.conf.d/10-aes67.conf&lt;/code&gt;&lt;/p&gt;\n&lt;figure data-rehype-pretty-code-figure=&quot;&quot;&gt;&lt;pre tabindex=&quot;0&quot; data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot;&gt;&lt;code data-language=&quot;sh&quot; data-theme=&quot;github-light github-dark&quot; style=&quot;display: grid;&quot;&gt;&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;mkdir&lt;/span&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt; -p&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; ~/.config/pipewire/pipewire.conf.d&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#005CC5;--shiki-dark:#79B8FF&quot;&gt;cd&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; ~/.config/pipewire/pipewire.conf.d&lt;/span&gt;&lt;/span&gt;\n&lt;span data-line=&quot;&quot;&gt;&lt;span style=&quot;--shiki-light:#6F42C1;--shiki-dark:#B392F0&quot;&gt;curl&lt;/span&gt;&lt;span style=&quot;--shiki-light:#032F62;--shiki-dark:#9ECBFF&quot;&gt; https://gist.githubusercontent.com/jmgrosen/fb214bb9fe36b27a8847b99c6590eb49/raw/7774310bcb8c698beda33b644f22d4e348f34446/10-aes67.conf&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;\n&lt;p&gt;Add &lt;code&gt;threadirqs&lt;/code&gt; to kernel command line &lt;code&gt;/boot/firmware/cmdline.txt&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;Unfortunately the builtin PWM-based audio driver for the Pi requires &lt;em&gt;very&lt;/em&gt; large period sizes (1024), so the lowest latency we seem to be able to get is about 46ms (&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.4831em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;≈&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.6444em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;⋅&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1em;vertical-align:-0.25em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1024/48000&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;). We will in fact need a different DAC to get decent latency.&lt;/p&gt;\n&lt;h1 id=&quot;host-audio-drivers&quot;&gt;Host Audio Drivers&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#host-audio-drivers&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;h2 id=&quot;linux&quot;&gt;Linux&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#linux&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;The Pipewire AES67 support seems to work pretty well. There’s also &lt;a href=&quot;https://github.com/bondagit/aes67-linux-daemon?tab=readme-ov-file&quot; class=&quot;external&quot;&gt;an ALSA driver&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; that I haven’t tried.&lt;/p&gt;\n&lt;h2 id=&quot;macos&quot;&gt;macOS&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#macos&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;The &lt;a href=&quot;https://www.merging.com/products/aes67-vad&quot; class=&quot;external&quot;&gt;Merging RAVENNA/AES67 Virtual Audio Device&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; seems to be the main driver. It used to be available for free, but now it’s $50. An even bigger issue is that it causes my laptop to kernel panic frequently, making it really a nonstarter for actual use. Might be good enough for testing, though. Follow &lt;a href=&quot;https://www.merging.com/uploads/assets/Installers/ravenna/Configure%20Merging%20and%20AES67%20Devices.pdf&quot; class=&quot;external&quot;&gt;this guide&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; to configure SAP announcements (in addition to the built-in RAVENNA (mDNS) announcements) that Pipewire can look for.&lt;/p&gt;\n&lt;h3 id=&quot;so-im-working-on-my-own&quot;&gt;so i’m working on my own&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#so-im-working-on-my-own&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h3&gt;\n&lt;h4 id=&quot;2024-10-12&quot;&gt;2024-10-12&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-12&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h4&gt;\n&lt;p&gt;working on the ptp implementation around statime. macos doesn’t seem to have a way to actually use any available hardware timestamping of ethernet interfaces? at least from userspace. it has the normal SO_TIMESTAMP (and mach_absolute_time-based SO_TIMESTAMP_MONOTONIC) for doing software timestamping on receives though. for now for TX timestamps i’ll just timestamp when a packet goes out from my code and eventually change to using the ptpd approach of using the multicast loopback receive to get the TX timestamp a bit closer to the metal.&lt;/p&gt;\n&lt;p&gt;do i have to make a shared-reference version of OverlayClock? probably&lt;/p&gt;\n&lt;p&gt;got frustrated.&lt;/p&gt;\n&lt;h2 id=&quot;links&quot;&gt;Links&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#links&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;to set dscp value correctly in the packets from the driver: &lt;a href=&quot;https://gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/src/modules/module-rtp-sink.c&quot; class=&quot;external&quot;&gt;https://gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/src/modules/module-rtp-sink.c&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;h1 id=&quot;stm32-based-prototype&quot;&gt;STM32-based prototype&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#stm32-based-prototype&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h1&gt;\n&lt;p&gt;got a Nucleo-F767ZI. got an STM32F7-based board because that’s what the statime-stm32 example uses.&lt;/p&gt;\n&lt;p&gt;also got a &lt;a href=&quot;https://shop.pimoroni.com/products/pico-audio-pack?variant=32369490853971&quot; class=&quot;external&quot;&gt;pimoroni pico audio kit&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; because that seemed like the simplest/cheapest i2s dac board that microcenter had with a jack rather than speaker amplifier.&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-12-1&quot;&gt;2024-10-12&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-12-1&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;hooked together the Nucleo and pimoroni kit:\n&lt;img src=&quot;../public-media/aes67-receiver/pico-audio-kit-pinout.webp&quot; width=&quot;auto&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;VSYS &lt;span&gt;←&lt;/span&gt;&gt; 5V&lt;/li&gt;\n&lt;li&gt;GND &lt;span&gt;←&lt;/span&gt;&gt; GND&lt;/li&gt;\n&lt;li&gt;MUTE &lt;span&gt;←&lt;/span&gt;&gt; CN8_16/D50/PG3&lt;/li&gt;\n&lt;li&gt;I2S_DATA &lt;span&gt;←&lt;/span&gt;&gt; CN7_3/D17/I2S_A_SD/PB15&lt;/li&gt;\n&lt;li&gt;I2S_BCK &lt;span&gt;←&lt;/span&gt;&gt; CN10_?/D?/?/PB10 (originally CN7_5/D18/I2S_A_CK/PB13 but that conflicts with ethernet pins)&lt;/li&gt;\n&lt;li&gt;I2S_LRCK &lt;span&gt;←&lt;/span&gt;&gt; CN7_7/D19/I2S_A_WS/PB12&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2 id=&quot;2024-10-13&quot;&gt;2024-10-13&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-13&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;trying to figure out how to do I2S on the STM32F7 from Rust. it seems like it’s not supported in stm32f7xx-hal, but the I2S peripheral on the stm32f7 is almost identical to that on the stm32f4, so hopefully we can steal some of the code from stm32f4xx-hal.&lt;/p&gt;\n&lt;p&gt;i realized the microusb cable i took home from resistor is power-only. rip.&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-14&quot;&gt;2024-10-14&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-14&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;at resistor, equipped with a proper microusb cable, i was able to program the board with statime-stm32 and receive ptp packets! however, i couldn’t get lawo vsc to synchronize with it… i’m not sure whether this is due to some big problem or the ptp profile probably not being set correctly in statime-stm32. the logs for lawo vsc say “cannot use PTP &lt;span&gt;⇒&lt;/span&gt; T1 value differs too much”.&lt;/p&gt;\n&lt;p&gt;i don’t think it’s just the port config. i changed the values to match those from the aes67 spec with no difference observed. i don’t see &lt;em&gt;any&lt;/em&gt; ptp packets coming from my laptop, though, which seems very odd? it’s not, like, sending them at a level too low for wireshark to see, is it?&lt;/p&gt;\n&lt;p&gt;i guess i’ll switch to getting i2s to work.&lt;/p&gt;\n&lt;p&gt;oh, it does sync with ptpd on my laptop, though! encouraging!&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-19&quot;&gt;2024-10-19&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-19&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;making progress on setting up the i2s in stm32f7xx-hal…&lt;/p&gt;\n&lt;p&gt;i was worried that i might not be able to get intra-sample phase sync (though it’s unclear how important that really is anyway…) due to not being able to “nudge” the i2s pll or in general control its phase, but then i realized that we’ll typically run the actual pll &lt;em&gt;a lot&lt;/em&gt; faster than the i2s bit clock and so &lt;a href=&quot;https://community.st.com/t5/stm32-mcus-products/synchronize-peripherals-sai-amp-i2s-output-clocks/m-p/718797/highlight/true#M260498&quot; class=&quot;external&quot;&gt;we can set the phase by controlling when exactly we enable the bit clock&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;. that means we should have like 10-100ns accuracy (at the example i2s clk frequency of ~61MHz) assuming we can work out the interrupts nicely.&lt;/p&gt;\n&lt;p&gt;… but of course we can’t control the precise frequency of the i2s plls across devices so what good is that. it doesn’t look like there’s an easy way to nudge the pll…&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-25&quot;&gt;2024-10-25&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-25&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;perhaps the stm32h7 has more appropriate PLLs? &lt;a href=&quot;https://community.st.com/t5/stm32-mcus-embedded-software/pll-anybody-using-the-internal-plls-as-vco-for-audio/td-p/145437&quot; class=&quot;external&quot;&gt;https://community.st.com/t5/stm32-mcus-embedded-software/pll-anybody-using-the-internal-plls-as-vco-for-audio/td-p/145437&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;or could just use an external vcxo, but that’s another part (but not &lt;em&gt;that&lt;/em&gt; expensive of a part—looks like an appropriate one on digikey for $1.67@qty100)&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-26&quot;&gt;2024-10-26&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-26&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;got i2s working, finally! really hacky driver wrapper at the moment, but it does the job&lt;/p&gt;\n&lt;h2 id=&quot;2024-10-27&quot;&gt;2024-10-27&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#2024-10-27&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;p&gt;gonna get dma working for the i2s then introduce rtic&lt;/p&gt;\n&lt;p&gt;godddd stm32f7xx-hal sucks… i don’t think rust is really a great idea on stm32s…&lt;/p&gt;"},"projects/folk-music":{"title":"folk music","links":[],"tags":[],"content":"Folk Computer is a system for reactive computing within a physical environment. It tries to push state out of the computer and integrate it into the tangible world, while maintaining at least some of the malleability of software. (At least, that’s my view of it.)\nI wrote some library code to allow it to interface with Supercollider, which is documented a little on Folk’s wiki if you want to try it yourself on a Folk instance.\nI then used this to build a simple sample looper, of which I have some videos of early versions:\n\n","richContent":"&lt;p&gt;&lt;a href=&quot;https://folk.computer/&quot; class=&quot;external&quot;&gt;Folk Computer&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; is a system for reactive computing within a physical environment. It tries to push state out of the computer and integrate it into the tangible world, while maintaining at least some of the malleability of software. (At least, that’s my view of it.)&lt;/p&gt;\n&lt;p&gt;I wrote some library code to allow it to interface with &lt;a href=&quot;https://supercollider.github.io/&quot; class=&quot;external&quot;&gt;Supercollider&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;, which is &lt;a href=&quot;https://folk.computer/supercollider&quot; class=&quot;external&quot;&gt;documented a little on Folk’s wiki&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; if you want to try it yourself on a Folk instance.&lt;/p&gt;\n&lt;p&gt;I then used this to build a simple sample looper, of which I have some videos of early versions:&lt;/p&gt;\n&lt;p&gt;&lt;iframe class=&quot;external-embed youtube&quot; allow=&quot;fullscreen&quot; frameborder=&quot;0&quot; width=&quot;600px&quot; src=&quot;https://www.youtube.com/embed/5CVXC-SCUPw&quot;&gt;&lt;/iframe&gt;&lt;/p&gt;\n&lt;p&gt;&lt;iframe class=&quot;external-embed youtube&quot; allow=&quot;fullscreen&quot; frameborder=&quot;0&quot; width=&quot;600px&quot; src=&quot;https://www.youtube.com/embed/zIT75BJtD8k&quot;&gt;&lt;/iframe&gt;&lt;/p&gt;"},"projects/hyperscale":{"title":"Hyperscale","links":[],"tags":[],"content":"\nAfter making a recipe a few times, I internalize the process pretty well, but I can’t remember the numbers involved, so I built a kitchen scale to do that for me.\nYou can get the board design files, case design files, and firmware source from its Github repo.\n\nIt shows a progress bar as you’re adding an ingredient—really useful for pacing how quickly I add an ingredient so as to not add too much.\nIt’s built on top of an OXO pull-out display kitchen scale, allowing the custom-designed portion to be limited in scope.\nThe case was designed in OpenSCAD and printed in PLA.\nThe original intention was for the scale to be completely controlled by your phone (no display or buttons or anything), but I found that I didn’t like always having to have my phone around, so I targeted this as at least the MVP.","richContent":"&lt;p&gt;&lt;img src=&quot;../public-media/hyperscale-20241016180345139.webp&quot; width=&quot;auto&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;\nAfter making a recipe a few times, I internalize the process pretty well, but I can’t remember the numbers involved, so I built a kitchen scale to do that for me.&lt;/p&gt;\n&lt;p&gt;You can get the board design files, case design files, and firmware source from &lt;a href=&quot;https://github.com/jmgrosen/hyperscale&quot; class=&quot;external&quot;&gt;its Github repo&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;.&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;../public-media/hyperscale-20241016173542832.webp&quot; width=&quot;auto&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;\nIt shows a progress bar as you’re adding an ingredient—really useful for pacing how quickly I add an ingredient so as to not add too much.&lt;/p&gt;\n&lt;p&gt;It’s built on top of an OXO pull-out display kitchen scale, allowing the custom-designed portion to be limited in scope.&lt;/p&gt;\n&lt;p&gt;The case was designed in OpenSCAD and printed in PLA.&lt;/p&gt;\n&lt;p&gt;The original intention was for the scale to be completely controlled by your phone (no display or buttons or anything), but I found that I didn’t like always having to have my phone around, so I targeted this as at least the MVP.&lt;/p&gt;"},"projects/miscellanea/Zoom-G1Xon-control":{"title":"Zoom G1Xon control","links":[],"tags":[],"content":"these are notes from a project zero and i did to control the Zoom G1Xon guitar multi-effects pedal in real-time over USB.\nthere are various pieces of software to edit and store patches for Zoom pedals, but they’re not so great for real-time control. nonetheless, they contain lots of useful information. we got most of ours from this wonderful project page and some of the code linked from the home page of that wiki. the B1on is moooooostly the same as the G1Xon.\nthe pedal communicates with a USB host using MIDI SysEx and CC messages. as documented on that wiki page, most of the SysEx commands require a model ID specific to the pedal; while the B1on’s is 0x65, the G1Xon’s is 0x64. (you can find this out with the “Identify” command.) oddly, we found that some commands work with the incorrect model ID in the command, while others do not, so if you are having trouble with inconsistency, make sure you’re using the right model ID everywhere.\nwhen trying to receive data back from the pedal (whether for the Identify command, the Get(Current)Patch commands, or when receiving patch fragments when making changes on-device), make sure that you have enabled receiving SysEx messages with whatever midi driver you are using; rtmidi, for example, filters them out by default. (zero brought up this possibility when i was stumped.)\nyou need to turn on edit mode before doing much stuff, including before the pedal will send values back when edited on-device.\nfor our purposes, the most useful commands are those labeled FXM_OnOff and FXM_PN. the former enables/disables pedals and the latter changes pedals’ parameters. stripped of the SysEx header/footer, the latter message looks like this:\n52 00 64 31 ${pedalIndex} ${paramIndex} ${paramValueLow} ${paramValueHigh}\n\nhere, pedalIndex is the 0-indexed index of the pedal within the effects chain, paramIndex is the… 2(?)-indexed index of the parameter within the specific pedal, paramValueLow is the low 7 bits of the value, and paramValueHigh is the high 7 bits of the value. we found that the paramValue maps exactly onto the value shown on the device—there’s no hidden extra precision—so if a value is 0-100 on the device, you send 0-100.\nthe values/sliders/dials on the device’s display update in real-time when sending new parameter values, even for effects that normally can’t be edited on-device. it’s cute to see some of the little dials spin!","richContent":"&lt;p&gt;these are notes from a project zero and i did to control the Zoom G1Xon guitar multi-effects pedal in real-time over USB.&lt;/p&gt;\n&lt;p&gt;there are various pieces of software to edit and store patches for Zoom pedals, but they’re not so great for real-time control. nonetheless, they contain lots of useful information. we got most of ours from &lt;a href=&quot;https://github.com/shooking/ZoomPedalFun/wiki/De-re-B1On&quot; class=&quot;external&quot;&gt;this wonderful project page&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt; and some of the code linked from the home page of that wiki. the B1on is moooooostly the same as the G1Xon.&lt;/p&gt;\n&lt;p&gt;the pedal communicates with a USB host using MIDI SysEx and CC messages. as documented on that wiki page, most of the SysEx commands require a model ID specific to the pedal; while the B1on’s is 0x65, the G1Xon’s is 0x64. (you can find this out with the “Identify” command.) oddly, we found that some commands work with the incorrect model ID in the command, while others do not, so if you are having trouble with inconsistency, make sure you’re using the right model ID everywhere.&lt;/p&gt;\n&lt;p&gt;when trying to receive data back from the pedal (whether for the Identify command, the Get(Current)Patch commands, or when receiving patch fragments when making changes on-device), make sure that you have enabled receiving SysEx messages with whatever midi driver you are using; rtmidi, for example, filters them out by default. (zero brought up this possibility when i was stumped.)&lt;/p&gt;\n&lt;p&gt;you need to turn on edit mode before doing much stuff, including before the pedal will send values back when edited on-device.&lt;/p&gt;\n&lt;p&gt;for our purposes, the most useful commands are those labeled FXM_OnOff and FXM_PN. the former enables/disables pedals and the latter changes pedals’ parameters. stripped of the SysEx header/footer, the latter message looks like this:&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;52 00 64 31 ${pedalIndex} ${paramIndex} ${paramValueLow} ${paramValueHigh}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;here, &lt;code&gt;pedalIndex&lt;/code&gt; is the 0-indexed index of the pedal within the effects chain, &lt;code&gt;paramIndex&lt;/code&gt; is the… 2(?)-indexed index of the parameter within the specific pedal, &lt;code&gt;paramValueLow&lt;/code&gt; is the low 7 bits of the value, and &lt;code&gt;paramValueHigh&lt;/code&gt; is the high 7 bits of the value. we found that the &lt;code&gt;paramValue&lt;/code&gt; maps exactly onto the value shown on the device—there’s no hidden extra precision—so if a value is 0-100 on the device, you send 0-100.&lt;/p&gt;\n&lt;p&gt;the values/sliders/dials on the device’s display update in real-time when sending new parameter values, even for effects that normally can’t be edited on-device. it’s cute to see some of the little dials spin!&lt;/p&gt;"},"projects/miscellanea/crashing-waves":{"title":"crashing waves","links":[],"tags":[],"content":"i built this in an RC creative coding session; the prompt was “what a wonderful world.”\nmess with a parameter to get the sound to start:\n","richContent":"&lt;p&gt;i built this in an RC creative coding session; the prompt was “what a wonderful world.”&lt;/p&gt;\n&lt;p&gt;mess with a parameter to get the sound to start:&lt;/p&gt;\n&lt;iframe width=&quot;500&quot; height=&quot;800&quot; src=&quot;https://jessie.grosen.systems/online-experiments/crashing-waves/&quot;&gt;&lt;/iframe&gt;"},"projects/mta-projection":{"title":"mta projection","links":[],"tags":[],"content":"\nlink to project\nwhy is a map different from a diagram? i recently heard the MTA’s typical subway map described as a bit of a misnomer, because its lack of strict adherence to physical layout instead makes it a diagram.\n\nwhat if we stubbornly held that this is, in fact, a map? there are lots of different types of maps of the same underlying earth—not just displaying different information (streets, topography, buildings), but different projections as well. the subway map does display our earthly terrain, but under a rather unorthodox projection.\nhow might we better understand this projection? by viewing satellite imagery of the city under it. i built this project to do that—hit the “transform!” button to see the mercator projection morph into the MTA projection.\nTODO\n\n fix across some more browsers (scaling seems like it has some issues in chrome among others?)\n beautify a bit\n maybe add a bit of dynamism even when not actively transforming\n","richContent":"&lt;iframe width=&quot;400&quot; height=&quot;500&quot; src=&quot;https://jessie.grosen.systems/mta-projection/&quot;&gt;&lt;/iframe&gt;\n&lt;p&gt;&lt;a href=&quot;https://jessie.grosen.systems/mta-projection/&quot; class=&quot;external&quot;&gt;link to project&lt;svg aria-hidden=&quot;true&quot; class=&quot;external-icon&quot; viewBox=&quot;0 0 512 512&quot;&gt;&lt;path d=&quot;M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;why is a &lt;em&gt;map&lt;/em&gt; different from a &lt;em&gt;diagram&lt;/em&gt;? i recently heard the MTA’s typical subway map described as a bit of a misnomer, because its lack of strict adherence to physical layout instead makes it a diagram.&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;../public-media/mta_subway_map.png&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;p&gt;what if we stubbornly held that this is, in fact, a map? there are lots of different types of maps of the same underlying earth—not just displaying different information (streets, topography, buildings), but different &lt;em&gt;projections&lt;/em&gt; as well. the subway map does display our earthly terrain, but under a rather unorthodox projection.&lt;/p&gt;\n&lt;p&gt;how might we better understand this projection? by viewing satellite imagery of the city under it. i built this project to do that—hit the “transform!” button to see the mercator projection morph into the MTA projection.&lt;/p&gt;\n&lt;h2 id=&quot;todo&quot;&gt;TODO&lt;a role=&quot;anchor&quot; aria-hidden tabindex=&quot;-1&quot; data-no-popover href=&quot;#todo&quot; class=&quot;internal&quot;&gt;&lt;svg width=&quot;18&quot; height=&quot;18&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;&lt;path d=&quot;M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;/h2&gt;\n&lt;ul class=&quot;contains-task-list&quot;&gt;\n&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; fix across some more browsers (scaling seems like it has some issues in chrome among others?)&lt;/li&gt;\n&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; beautify a bit&lt;/li&gt;\n&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; maybe add a bit of dynamism even when not actively transforming&lt;/li&gt;\n&lt;/ul&gt;"},"talks/mustard-watches":{"title":"mustard watches","links":[],"tags":[],"content":"\ni gave a short talk on y j ringard’s famous 1990 paper “mustard watches: an integrated approach to time and food” at cmu plunch on march 4, 2022. i covered both the material in the original paper and some of the developments that have happened since. the slides follow:\n","richContent":"&lt;p&gt;&lt;img src=&quot;../public-media/IMG_1570.jpeg&quot; width=&quot;400&quot; height=&quot;auto&quot; alt=&quot;&quot;&gt;&lt;/p&gt;\n&lt;p&gt;i gave a short talk on y j ringard’s famous 1990 paper “mustard watches: an integrated approach to time and food” at cmu plunch on march 4, 2022. i covered both the material in the original paper and some of the developments that have happened since. the slides follow:&lt;/p&gt;\n&lt;p&gt;&lt;iframe src=&quot;../public-media/mustard-watches.pdf&quot; class=&quot;pdf&quot;&gt;&lt;/iframe&gt;&lt;/p&gt;"}}